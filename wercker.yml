---
box: wercker/golang
build:
  steps:
    - setup-go-workspace
    - script:
        code: |
            cd $WERCKER_SOURCE_DIR
            go version
            go get -t github.com/lox/httpcache
        name: "go get"
    - script:
        code: "go build ./...\n"
        name: "go build"
    - script:
        code: "go test -v\n"
        name: "go test"
    - script:
        code: "rsync -avz \"$WERCKER_SOURCE_DIR/\" \"$WERCKER_OUTPUT_DIR\""
        name: "copy output"
deploy:
  steps:
    - script:
        name: get version from rake
        code: export APP_VERSION=$(rake appversion)

    - github-create-release:
        token: $GITHUB_TOKEN
        tag: v1.0.0
